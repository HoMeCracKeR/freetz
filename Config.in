mainmenu "Freetz Configuration"

config FREETZ_HAVE_DOT_CONFIG
	bool
	default y


comment "User competence ------------------------"

choice
	prompt "Level of user competence"
	default FREETZ_USER_LEVEL_BEGINNER
	help
		Select your level of competence in regard to such aspects as:
		- modifying firmware of embedded devices
		- Linux based operating systems
		- cross-compiling software
		- tracking software/hardware problems down

		The higher the selected level (beginner << advanced << expert)
		the more options for customizing the firmware are shown.

		Please select levels greater than beginner only
		if you really need to and know what you're doing.

	config FREETZ_USER_LEVEL_BEGINNER
		bool "Beginner"

	config FREETZ_USER_LEVEL_ADVANCED
		bool "Advanced"
		select FREETZ_SHOW_ADVANCED

	config FREETZ_USER_LEVEL_EXPERT
		bool "Expert"
		select FREETZ_SHOW_ADVANCED
		select FREETZ_SHOW_EXPERT
endchoice

config FREETZ_SHOW_ADVANCED
	bool
config FREETZ_SHOW_EXPERT
	bool


source config/gui/firmware.in


comment "Original components --------------------"

comment "Hint: Select build toolchain if you want to enable IPv6 support"
	depends on \
		( \
			FREETZ_AVM_HAS_IPV6 || \
			(FREETZ_SHOW_ADVANCED && FREETZ_REPLACE_KERNEL_AVAILABLE) \
		) && \
		(FREETZ_TARGET_UCLIBC_0_9_28 && FREETZ_DOWNLOAD_TOOLCHAIN && !FREETZ_DL_TOOLCHAIN_OVERRIDE)

config FREETZ_TARGET_IPV6_SUPPORT
	bool "IPv6 support"
	depends on \
		( \
			FREETZ_AVM_HAS_IPV6 || \
			(FREETZ_SHOW_ADVANCED && FREETZ_REPLACE_KERNEL_AVAILABLE) \
		) && \
		! (FREETZ_TARGET_UCLIBC_0_9_28 && FREETZ_DOWNLOAD_TOOLCHAIN && !FREETZ_DL_TOOLCHAIN_OVERRIDE)
	select FREETZ_REPLACE_KERNEL if ! (FREETZ_AVM_HAS_IPV6)
	select FREETZ_MODULE_ipv6    if ! (FREETZ_AVM_HAS_IPV6) && FREETZ_REPLACE_KERNEL
	select FREETZ_BUSYBOX__IPV6_UTILS
	default n
	help
		Copies the ipv6 kernel module to the firmware and enables ipv6 support
		in uClibc and busybox.
		Shows additional options for busybox and iptables and other packages.
		To use IPv6 with Fritz!Box, at least the kernel, ucLibc and busybox
		have to be recompiled with IPv6 enabled.
		The toolchain will automatically be rebuild to achieve this.
		It is also recommended to include the package iptables/ip6tables for
		firewall settings.

if FREETZ_SHOW_ADVANCED

comment "Replace kernel (not available, no sources by AVM)"
	depends on ! FREETZ_REPLACE_KERNEL_AVAILABLE

config FREETZ_REPLACE_KERNEL
	bool "Replace kernel"
	depends on FREETZ_REPLACE_KERNEL_AVAILABLE
	# until http://freetz.org/ticket/1716 is fixed:
	select FREETZ_REMOVE_KIDS if \
		( \
			FREETZ_TYPE_2170 || \
			FREETZ_TYPE_3170 \
		)
	select FREETZ_MODULE_fuse if \
		( \
			FREETZ_AVM_VERSION_3370_05_21 || \
			FREETZ_AVM_VERSION_7270_04_86 || \
			FREETZ_AVM_VERSION_7270_05_21 || \
			FREETZ_AVM_VERSION_7270_05_50 || \
			FREETZ_AVM_VERSION_7270_05_51 || \
			FREETZ_AVM_VERSION_7330_05_20 || \
			FREETZ_AVM_VERSION_7330_05_50 || \
			FREETZ_AVM_VERSION_7360_05_20 || \
			FREETZ_AVM_VERSION_7360_05_50 || \
			FREETZ_AVM_VERSION_7360_05_51 || \
			FREETZ_AVM_VERSION_7390_05_21 || \
			FREETZ_AVM_VERSION_7390_05_52 || \
			FREETZ_AVM_VERSION_7390_06_00 || \
			FREETZ_AVM_VERSION_7390_06_01 \
		) && \
		! (FREETZ_REMOVE_NTFS && FREETZ_REMOVE_WEBDAV)
	select FREETZ_MODULE_jffs2 if \
		! FREETZ_REMOVE_JFFS2 && \
		( \
			FREETZ_AVM_VERSION_7330_05_20 || \
			FREETZ_AVM_VERSION_7330_05_50 || \
			FREETZ_AVM_VERSION_7360_05_20 || \
			FREETZ_AVM_VERSION_7360_05_50 || \
			FREETZ_AVM_VERSION_7360_05_51 \
				)
	select FREETZ_MODULE_usbcore if \
		FREETZ_KERNEL_LAYOUT_UR8 && FREETZ_AVM_VERSION_7270_04_86
	select FREETZ_MODULE_msdos if \
		! FREETZ_REMOVE_FAT && \
		( \
			FREETZ_AVM_VERSION_7270_05_21 || \
			FREETZ_AVM_VERSION_7270_05_50 || \
			FREETZ_AVM_VERSION_7270_05_51 \
		)
	select FREETZ_MODULE_vfat if \
		! FREETZ_REMOVE_FAT && \
		( \
			FREETZ_AVM_VERSION_7270_05_21 || \
			FREETZ_AVM_VERSION_7270_05_50 || \
			FREETZ_AVM_VERSION_7270_05_51 \
		)
	default n
	help
		Replace AVM kernel with self-built kernel.

endif # FREETZ_SHOW_ADVANCED #

menu "SquashFS options"
	visible if FREETZ_SHOW_EXPERT

	comment "CAUTION: SquashFS block sizes >64 KB can cause an unstable box due to extensive memory usage"
		depends on ! (FREETZ_SQUASHFS_BLOCKSIZE_ORIG || FREETZ_SQUASHFS_BLOCKSIZE_65536)

	choice
		prompt "SquashFS block size"
		default FREETZ_SQUASHFS_BLOCKSIZE_65536

		config FREETZ_SQUASHFS_BLOCKSIZE_ORIG
			bool "original (usually 64 KB)"
			help
				Block size of the root filesystem. SquashFS 2.x can use block sizes
				up to 64 KB, SquashFS 3.x (only available for kernel 2.6.19.2 or
				with "replace kernel") up to 1024 KB. Bigger block sizes achieve
				better compression ratios than smaller ones.

				64 KB is the default for kernel 2.6 firmwares.

		config FREETZ_SQUASHFS_BLOCKSIZE_65536
			bool "64 KB"
			help
				Block size of the root filesystem. SquashFS 2.x can use block sizes
				up to 64 KB, SquashFS 3.x (only available for kernel 2.6.19.2 or
				with "replace kernel") up to 1024 KB. Bigger block sizes achieve
				better compression ratios than smaller ones.

				64 KB is the default for kernel 2.6 firmwares.

		if FREETZ_REPLACE_KERNEL && !FREETZ_KERNEL_VERSION_2_6_32_60
			config FREETZ_SQUASHFS_BLOCKSIZE_131072
				bool "128 KB - EXPERIMENTAL"
				help
					Block size of the root filesystem. SquashFS 3.4 can use block sizes
					up to 1MB but the Default used by Freetz is 64KB. SquashFS 3.4 which
					is included in Kernel 2.6.32 has a default Block size of 128 KB.

			config FREETZ_SQUASHFS_BLOCKSIZE_262144
				bool "256 KB - EXPERIMENTAL"
			config FREETZ_SQUASHFS_BLOCKSIZE_524288
				bool "512 KB - EXPERIMENTAL"
			config FREETZ_SQUASHFS_BLOCKSIZE_1048576
				bool "1024 KB - EXPERIMENTAL"
		endif

	endchoice # "SquashFS block size" #

config FREETZ_SQUASHFS_BLOCKSIZE
	int
	default 65536 if FREETZ_SQUASHFS_BLOCKSIZE_65536
	default 131072 if FREETZ_SQUASHFS_BLOCKSIZE_131072
	default 262144 if FREETZ_SQUASHFS_BLOCKSIZE_262144
	default 524288 if FREETZ_SQUASHFS_BLOCKSIZE_524288
	default 1048576 if FREETZ_SQUASHFS_BLOCKSIZE_1048576
	help
		Numeric SquashFS block size in bytes

endmenu # SquashFS options #


source config/gui/patches.in


comment "Additional components ------------------"

menu "Packages"
	comment "*** not all packages support selected language ***"
		depends on ! FREETZ_LANG_DE

	config FREETZ_SELECTED_LANG_ONLY
		bool "Packages supporting selected language only"
		depends on ! FREETZ_LANG_DE
		default n
		help
			Show only packages supporting the selected language. Packages not
			supporting your selected language can be installed, but they will be in
			default language (usually German).


	source make/Config.in.generated
endmenu # "Package selection" #


menu "Shared libraries"
	visible if FREETZ_SHOW_ADVANCED
	source make/libs/Config.in
endmenu # "Shared libraries" #


source config/avm/kernel.in
comment "Kernel modules (not available, no sources by AVM)"
	depends on ! FREETZ_REPLACE_MODULE_AVAILABLE
menu "Kernel modules"
	visible if FREETZ_SHOW_ADVANCED
	depends on FREETZ_REPLACE_MODULE_AVAILABLE
	source config/gui/modules.in
endmenu # "Kernel modules" #

menu "Busybox applets"
	visible if FREETZ_SHOW_ADVANCED
	depends on FREETZ_REPLACE_BUSYBOX
	source make/busybox/Config.in
endmenu # "Busybox applets" #


source config/gui/external.in
source config/gui/freetz.in
source config/gui/building.in
source config/gui/packing.in
source config/mod/download.in
source config/custom.in

### everything below is not visible

source config/mod/firmware.in
source config/avm/uclibc.in
source config/avm/compiler.in
source config/mod/packages.in
source config/avm/features.in


comment "Custom options -------------------------"
	depends on FREETZ_TYPE_CUSTOM

config FREETZ_INSTALL_BASE
	bool
	select FREETZ_PACKAGE_MOD
	select FREETZ_PACKAGE_HASERL
	select FREETZ_LIB_ld_uClibc
	select FREETZ_LIB_libcrypt
	select FREETZ_LIB_libdl
	select FREETZ_LIB_libgcc_s
	select FREETZ_LIB_libm
	select FREETZ_LIB_libnsl
	select FREETZ_LIB_libpthread
	select FREETZ_LIB_librt
	select FREETZ_LIB_libubacktrace if FREETZ_TARGET_UCLIBC_REQUIRES_libubacktrace
	select FREETZ_LIB_libuClibc
	select FREETZ_LIB_libctlmgr if FREETZ_AVM_HAS_USB_HOST
	default y
	help
		This is mandatory

config FREETZ_REPLACE_BUSYBOX
	bool
	select FREETZ_BUSYBOX__MANDATORY
	select FREETZ_BUSYBOX__MANDATORY_05_XX if FREETZ_AVM_VERSION_05_2X_MIN
	default y
	help
		This is mandatory


config FREETZ_TARGET_ARCH_LE
	bool
	default y
	depends on \
		FREETZ_TYPE_2170 || \
		FREETZ_TYPE_300IP || \
		FREETZ_TYPE_FON || \
		FREETZ_TYPE_5010 || \
		FREETZ_TYPE_5050 || \
		FREETZ_TYPE_5124 || \
		FREETZ_TYPE_5140 || \
		FREETZ_TYPE_WLAN || \
		FREETZ_TYPE_7050 || \
		FREETZ_TYPE_7112 || \
		FREETZ_TYPE_7113 || \
		FREETZ_TYPE_7141 || \
		FREETZ_TYPE_7140 || \
		FREETZ_TYPE_7150 || \
		FREETZ_TYPE_7170 || \
		FREETZ_TYPE_7240 || \
		FREETZ_TYPE_7270 || \
		FREETZ_TYPE_7570 || \
		FREETZ_TYPE_7570 || \
		FREETZ_TYPE_3020 || \
		FREETZ_TYPE_3030 || \
		FREETZ_TYPE_3130 || \
		FREETZ_TYPE_3131 || \
		FREETZ_TYPE_3170 || \
		FREETZ_TYPE_3270 || \
		FREETZ_TYPE_W501V

config FREETZ_TARGET_ARCH_BE
	bool
	default y
	depends on \
		FREETZ_TYPE_3272 || \
		FREETZ_TYPE_3370 || \
		FREETZ_TYPE_3390 || \
		FREETZ_TYPE_6810 || \
		FREETZ_TYPE_6840 || \
		FREETZ_TYPE_6842 || \
		FREETZ_TYPE_7272 || \
		FREETZ_TYPE_7312 || \
		FREETZ_TYPE_7320 || \
		FREETZ_TYPE_7330 || \
		FREETZ_TYPE_7340 || \
		FREETZ_TYPE_7360 || \
		FREETZ_TYPE_7362 || \
		FREETZ_TYPE_7390 || \
		FREETZ_TYPE_7490

config FREETZ_TARGET_ARCH
	string
	default "mips" if FREETZ_TARGET_ARCH_BE
	default "mipsel" if FREETZ_TARGET_ARCH_LE

config FREETZ_TARGET_CROSS
	string
	default "mips-linux-uclibc-" if FREETZ_TARGET_ARCH_BE
	default "mipsel-linux-uclibc-" if FREETZ_TARGET_ARCH_LE

config FREETZ_TARGET_MAKE_PATH
	string
	default "toolchain/target/bin"

config FREETZ_KERNEL_CROSS
	string
	default "mips-unknown-linux-gnu-" if FREETZ_TARGET_ARCH_BE
	default "mipsel-unknown-linux-gnu-" if FREETZ_TARGET_ARCH_LE

config FREETZ_KERNEL_MAKE_PATH
	string
	default "toolchain/kernel/bin"


config FREETZ_FILESYSTEM_MTD_SIZE
	int "FILESYSTEM (64K blocks)"   if FREETZ_TYPE_CUSTOM
	default 768         if \
		FREETZ_TYPE_3370 || \
		FREETZ_TYPE_3390 || \
		FREETZ_TYPE_6810 || \
		FREETZ_TYPE_6840 || \
		FREETZ_TYPE_6842
	default 0
	help
		Number of 64K blocks in the filesystem mtd device.


config FREETZ_KERNEL_CUSTOM_MTD_SIZE
	int "Kernel (64K blocks)"   if FREETZ_TYPE_CUSTOM
	default 59	if FREETZ_TYPE_3170_7170
	default 119	if FREETZ_TYPE_7270_V1_V2
	default 122	if FREETZ_TYPE_7570_IAD && ! FREETZ_REPLACE_KERNEL
	default 244	if FREETZ_TYPE_7570_IAD && FREETZ_REPLACE_KERNEL
	default 246	if FREETZ_TYPE_7270_V2_V1
	help
		Custom number of 64K blocks in the kernel mtd device.

config FREETZ_FILESYSTEM_CUSTOM_MTD_SIZE
	int "Filesystem (64K blocks)"   if FREETZ_TYPE_CUSTOM
	help
		Custom number of 64K blocks in the filesystem mtd device.


source config/avm/firmware.in

