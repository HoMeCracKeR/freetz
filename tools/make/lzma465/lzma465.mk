LZMA465_VERSION:=465
LZMA465_SOURCE:=lzma$(LZMA465_VERSION).tar.bz2
LZMA465_SOURCE_MD5:=29d5ffd03a5a3e51aef6a74e9eafb759
LZMA465_SITE:=@SF/sevenzip

LZMA465_DIR:=$(TOOLS_SOURCE_DIR)/lzma$(LZMA465_VERSION)
LZMA465_MAKE_DIR:=$(TOOLS_DIR)/make/lzma$(LZMA465_VERSION)
LZMA465_ALONE_DIR:=$(LZMA465_DIR)/CPP/7zip/Compress/LZMA_Alone
LZMA465_LIB_DIR:=$(LZMA465_DIR)/CPP/7zip/Compress/LZMA_Lib

lzma$(LZMA465_VERSION)-source: $(DL_DIR)/$(LZMA465_SOURCE)
$(DL_DIR)/$(LZMA465_SOURCE): | $(DL_DIR)
	$(DL_TOOL) $(DL_DIR) $(LZMA465_SOURCE) $(LZMA465_SITE) $(LZMA465_SOURCE_MD5)

lzma$(LZMA465_VERSION)-unpacked: $(LZMA465_DIR)/.unpacked
$(LZMA465_DIR)/.unpacked: $(DL_DIR)/$(LZMA465_SOURCE) | $(TOOLS_SOURCE_DIR) $(UNPACK_TARBALL_PREREQUISITES)
	mkdir -p $(LZMA465_DIR)
	$(call UNPACK_TARBALL,$(DL_DIR)/$(LZMA465_SOURCE),$(LZMA465_DIR))
	$(call APPLY_PATCHES,$(LZMA465_MAKE_DIR)/patches,$(LZMA465_DIR))
	touch $@

$(LZMA465_ALONE_DIR)/lzma: $(LZMA465_DIR)/.unpacked
	$(MAKE) -f makefile.gcc -C $(LZMA465_ALONE_DIR)

$(LZMA465_LIB_DIR)/liblzma.a: $(LZMA465_DIR)/.unpacked
	$(MAKE) -f makefile.gcc -C $(LZMA465_LIB_DIR)
	touch -c $@

$(LZMA465_DIR)/liblzma.a: $(LZMA465_LIB_DIR)/liblzma.a
	$(INSTALL_FILE)

$(TOOLS_DIR)/lzma$(LZMA465_VERSION): $(LZMA465_ALONE_DIR)/lzma
	$(INSTALL_FILE)

lzma$(LZMA465_VERSION): $(LZMA465_DIR)/liblzma.a $(TOOLS_DIR)/lzma$(LZMA465_VERSION)

lzma$(LZMA465_VERSION)-clean:
	-$(MAKE) -C $(LZMA465_LIB_DIR) clean
	$(RM) $(LZMA465_DIR)/liblzma.a

lzma$(LZMA465_VERSION)-dirclean:
	$(RM) -r $(LZMA465_DIR)

lzma$(LZMA465_VERSION)-distclean: lzma$(LZMA465_VERSION)-dirclean
	$(RM) $(TOOLS_DIR)/lzma$(LZMA465_VERSION)
