-include $(call sorted-wildcard,toolchain/kernel/*/Makefile.in)
-include $(call sorted-wildcard,toolchain/target/*/Makefile.in)

KERNEL_TOOLCHAIN_GCC_VERSION:=$(call qstrip,$(FREETZ_KERNEL_GCC_VERSION))
KERNEL_TOOLCHAIN_GCC_MAJOR_VERSION:=$(call GET_MAJOR_VERSION,$(KERNEL_TOOLCHAIN_GCC_VERSION))
KERNEL_TOOLCHAIN_BINUTILS_VERSION:=$(call qstrip,$(FREETZ_KERNEL_BINUTILS_VERSION))
KERNEL_TOOLCHAIN_BINUTILS_MAJOR_VERSION:=$(call GET_MAJOR_VERSION,$(KERNEL_TOOLCHAIN_BINUTILS_VERSION))

KERNEL_TOOLCHAIN_COMPILER:=$(TARGET_ARCH)_gcc-$(KERNEL_TOOLCHAIN_GCC_VERSION)
KERNEL_TOOLCHAIN_DIR:=$(SOURCE_DIR_ROOT)/toolchain-$(KERNEL_TOOLCHAIN_COMPILER)
#KERNEL_TOOLCHAIN_STAGING_DIR:=$(TOOLCHAIN_DIR_KERNEL)/$(REAL_GNU_KERNEL_NAME)
KERNEL_CROSS_COMPILER:=$(KERNEL_TOOLCHAIN_STAGING_DIR)/bin/$(REAL_GNU_KERNEL_NAME)-gcc

KERNEL_TOOLCHAIN_PATH:=$(TOOLCHAIN_DIR_KERNEL)/bin:/bin:/sbin:/usr/bin:/usr/sbin

ifeq ($(strip $(FREETZ_KERNEL_COMPILER_GCC_3_4)),y)
KERNEL_TOOLCHAIN_NO_MPFR:=y
endif

TARGET_TOOLCHAIN_GCC_VERSION:=$(call qstrip,$(FREETZ_TARGET_GCC_VERSION))
TARGET_TOOLCHAIN_GCC_MAJOR_VERSION:=$(call GET_MAJOR_VERSION,$(TARGET_TOOLCHAIN_GCC_VERSION))
TARGET_TOOLCHAIN_UCLIBC_VERSION:=$(call qstrip,$(FREETZ_TARGET_UCLIBC_VERSION))
TARGET_TOOLCHAIN_BINUTILS_VERSION:=$(call qstrip,$(FREETZ_TARGET_BINUTILS_VERSION))
TARGET_TOOLCHAIN_BINUTILS_MAJOR_VERSION:=$(call GET_MAJOR_VERSION,$(TARGET_TOOLCHAIN_BINUTILS_VERSION))

TARGET_TOOLCHAIN_UCLIBC_REF:=$(call qstrip,$(FREETZ_TARGET_UCLIBC_REF))

TARGET_TOOLCHAIN_COMPILER:=$(TARGET_ARCH)_gcc-$(TARGET_TOOLCHAIN_GCC_VERSION)_uClibc-$(TARGET_TOOLCHAIN_UCLIBC_VERSION)
TARGET_TOOLCHAIN_DIR:=$(SOURCE_DIR_ROOT)/toolchain-$(TARGET_TOOLCHAIN_COMPILER)
#TARGET_TOOLCHAIN_STAGING_DIR:=$(TOOLCHAIN_DIR_TARGET)/$(REAL_GNU_TARGET_NAME)
TARGET_CROSS_COMPILER:=$(TARGET_TOOLCHAIN_STAGING_DIR)/usr/bin/$(REAL_GNU_TARGET_NAME)-gcc
TARGET_CXX_CROSS_COMPILER_SYMLINK:=$(TARGET_TOOLCHAIN_STAGING_DIR)/usr/bin/$(REAL_GNU_TARGET_NAME)-g++-wrapper
TARGET_CXX_CROSS_COMPILER_CCACHE_SYMLINK:=$(TARGET_TOOLCHAIN_STAGING_DIR)/usr/bin-ccache/$(REAL_GNU_TARGET_NAME)-g++-wrapper
TARGET_CXX_CROSS_COMPILER_SYMLINK_TIMESTAMP:=$(TARGET_CXX_CROSS_COMPILER_SYMLINK).timestamp
TARGET_TOOLCHAIN_KERNEL_VERSION_HEADER:=$(TARGET_TOOLCHAIN_STAGING_DIR)/usr/include/linux/version.h
TARGET_UTILS_DIR:=$(TARGET_TOOLCHAIN_STAGING_DIR)/target-utils

STDCXXLIB:=$(call qstrip,$(FREETZ_STDCXXLIB))

# Use this paths to search for our compilers
KERNEL_MAKE_PATH:=$(KERNEL_TOOLCHAIN_STAGING_DIR)/bin
TARGET_MAKE_PATH:=$(TARGET_TOOLCHAIN_STAGING_DIR)/bin

ifeq ($(strip $(FREETZ_BUILD_TOOLCHAIN)),y)
TOOLCHAIN:=kernel-toolchain target-toolchain
else
TOOLCHAIN:=download-toolchain
endif

$(TARGET_CXX_CROSS_COMPILER_SYMLINK_TIMESTAMP): $(TOPDIR)/.config | gcc $(if $(FREETZ_TOOLCHAIN_CCACHE),ccache)
	$(RM) $(TARGET_CXX_CROSS_COMPILER_SYMLINK) $(TARGET_CXX_CROSS_COMPILER_CCACHE_SYMLINK)
	ln -fs $(REAL_GNU_TARGET_NAME)-g++$(if $(FREETZ_STDCXXLIB_USE_UCLIBCXX),-uc) $(TARGET_CXX_CROSS_COMPILER_SYMLINK)
	$(if \
		$(and $(FREETZ_STDCXXLIB_USE_GNULIBSTDCXX),$(FREETZ_TOOLCHAIN_CCACHE)), \
		ln -fs $(REAL_GNU_TARGET_NAME)-g++ $(TARGET_CXX_CROSS_COMPILER_CCACHE_SYMLINK), \
		true \
	)
	@touch $@

toolchain-dirclean: kernel-toolchain-dirclean target-toolchain-dirclean

toolchain-distclean: kernel-toolchain-distclean target-toolchain-distclean
	$(RM) -r $(TOOLCHAIN_BUILD_DIR)

kernel-toolchain-distclean: kernel-toolchain-dirclean
	$(RM) -r $(SOURCE_DIR_ROOT)/toolchain/kernel
	$(RM) $(TOOLCHAIN_DIR)/kernel
	$(RM) $(KERNEL_TOOLCHAIN_SYMLINK_DOT_FILE)

target-toolchain-distclean: target-toolchain-dirclean
	$(RM) -r $(SOURCE_DIR_ROOT)/toolchain/target
	$(RM) $(TOOLCHAIN_DIR)/target
	$(RM) $(TARGET_TOOLCHAIN_SYMLINK_DOT_FILE)

include toolchain/toolchain-common.in
